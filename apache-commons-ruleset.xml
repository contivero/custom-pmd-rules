<?xml version="1.0" encoding="UTF-8"?>
<ruleset xmlns="http://pmd.sourceforge.net/ruleset/2.0.0">

   <!-- StringUtils rules  -->
   <rule name="Prefer_StringUtils_isNotEmpty" language="java" message="Prefer StringUtils.isNotEmpty" class="net.sourceforge.pmd.lang.rule.XPathRule">
   <description>
      Instead of checking if a String is different from null and the empty string, use StringUtils.isNotEmpty
   </description>
   <priority>4</priority>
   <properties>
      <property name="version" value="2.0"/>
      <property name="xpath">
         <value>
<![CDATA[
(//ConditionalAndExpression[
EqualityExpression[@Image="!="][
  PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
  and PrimaryExpression/PrimaryPrefix/Name
  ] and (UnaryExpressionNotPlusMinus[@Image="!"]/PrimaryExpression[
    (PrimaryPrefix/Literal[@Image='""']
    and PrimarySuffix[@Image="equals"]
    and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Name[@Image=../../../../../../../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image]
    ) or (
      PrimaryPrefix/Name[@Image = concat(../../../../EqualityExpression[@Image="!="]/PrimaryExpression/PrimaryPrefix/Name/@Image, ".equals")]
      and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Literal[@Image='""']
    )
  ] or EqualityExpression[@Image = "=="][
     PrimaryExpression/PrimaryPrefix/Literal/BooleanLiteral[@True = false()]
     and (
       PrimaryExpression[
         PrimaryPrefix/Literal[@Image='""']
         and PrimarySuffix[@Image="equals"]
         and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Name[@Image=../../../../../../../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image]
       ]) or (
       PrimaryExpression/PrimaryPrefix/Name[@Image = concat(../../../../EqualityExpression[@Image="!="]/PrimaryExpression/PrimaryPrefix/Name/@Image , ".equals")]
     )
]
)
]

|

//UnaryExpressionNotPlusMinus[@Image="!"]/PrimaryExpression/PrimaryPrefix/Expression/ConditionalOrExpression[
 EqualityExpression[@Image="=="][PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
  and PrimaryExpression/PrimaryPrefix/Name]
  and PrimaryExpression[
   PrimaryPrefix/Literal[@Image='""']
   and PrimarySuffix[@Image="equals"]
   and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Name[@Image=../../../../../../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image]
  or (
   PrimaryPrefix/Name[@Image = concat(../../../EqualityExpression[@Image="=="]/PrimaryExpression/PrimaryPrefix/Name/@Image, ".equals")]
   and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Literal[@Image='""']
  )
 ]
]

|

//EqualityExpression[@Image="=="][
 PrimaryExpression/PrimaryPrefix/Literal/BooleanLiteral[@True = false()]
 and PrimaryExpression/PrimaryPrefix/Expression/ConditionalOrExpression[
   EqualityExpression[@Image = "=="][
         PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
     and PrimaryExpression/PrimaryPrefix/Name
   ] and (PrimaryExpression[
     PrimaryPrefix/Literal[@Image='""']
     and PrimarySuffix[@Image = "equals"]
     and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Name[@Image = ../../../../../../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image]
   ] or (
       PrimaryExpression/PrimaryPrefix/Name[@Image = concat(../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image, ".equals")]
       and PrimaryExpression/PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Literal[@Image='""']
    )
   )
 ]
]
)
]]>
         </value>
      </property>
   </properties>
</rule>

<rule name="Prefer_StringUtils.isEmpty"
      language="java"
      message="Use StringUtils.isEmpty()"
      class="net.sourceforge.pmd.lang.rule.XPathRule">
   <description>
      Instead of checking against null and the empty string explicitly, use StringUtils.isEmpty
   </description>
   <priority>4</priority>
   <properties>
      <property name="version" value="2.0"/>
      <property name="xpath">
         <value>
<![CDATA[
//ConditionalOrExpression[
  EqualityExpression[@Image="=="][
    PrimaryExpression/PrimaryPrefix/Name[pmd-java:typeIs("java.lang.String")]
    and PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
  ] and (
      (PrimaryExpression[
      PrimaryPrefix/Literal[@Image='""']
      and PrimarySuffix[@Image="equals"]
      and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Name[@Image=../../../../../../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image]
    ]) or (
      PrimaryExpression[
        PrimaryPrefix/Name[@Image=concat(../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image, ".equals")]
        and PrimarySuffix/Arguments/ArgumentList/Expression/PrimaryExpression/PrimaryPrefix/Literal[@Image='""']
      ]
    )
  )
]
]]>
         </value>
      </property>
   </properties>
</rule>

   <!-- CollectionUtils rules  -->
<rule name="Prefer_CollectionUtils.isEmpty"
      language="java"
      message="Use org.apache.commons.collections.CollectionUtils.isEmpty()"
      class="net.sourceforge.pmd.lang.rule.XPathRule">
   <description>
      Instead of checking against null and if the collection is empty explicitly, use CollectionUtils.isEmpty
   </description>
   <priority>5</priority>
   <properties>
      <property name="version" value="2.0"/>
      <property name="xpath">
         <value>
<![CDATA[
//ConditionalOrExpression[
  EqualityExpression[@Image="=="][
    PrimaryExpression/PrimaryPrefix/Name[pmd-java:typeIs("java.util.Collection")]
    and PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
  ] and PrimaryExpression/PrimaryPrefix/Name[@Image = concat(../../../EqualityExpression["=="]/PrimaryExpression/PrimaryPrefix/Name/@Image, ".isEmpty")]
]
]]>
         </value>
      </property>
   </properties>
</rule>

<rule name="Prefer_CollectionUtils.isNotEmpty"
      language="java"
      message="Use CollectionUtils.isNotEmpty()"
      class="net.sourceforge.pmd.lang.rule.XPathRule">
   <description>
	Use CollectionUtils.isNotEmpty()
   </description>
   <priority>5</priority>
   <properties>
      <property name="version" value="2.0"/>
      <property name="xpath">
         <value>
<![CDATA[
(//ConditionalAndExpression[
  EqualityExpression[@Image="!="][
    PrimaryExpression/PrimaryPrefix/Name[pmd-java:typeIs("java.util.Collection")]
    and PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
  ] and (
      UnaryExpressionNotPlusMinus[@Image="!"]/PrimaryExpression[
        PrimaryPrefix/Name[@Image = concat(../../../../EqualityExpression/PrimaryExpression/PrimaryPrefix/Name/@Image, ".isEmpty")]
        and PrimarySuffix/Arguments
      ]
    ) or (
      EqualityExpression[@Image = "=="][
        PrimaryExpression[
          PrimaryPrefix/Name[@Image = concat(../../../../EqualityExpression[@Image="!="]/PrimaryExpression/PrimaryPrefix/Name/@Image, ".isEmpty")]
          and PrimarySuffix/Arguments
        ] and PrimaryExpression/PrimaryPrefix/Literal/BooleanLiteral[@True = false()]
      ]
    )
]
|
//UnaryExpressionNotPlusMinus[@Image="!"][
  PrimaryExpression/PrimaryPrefix/Expression/ConditionalOrExpression[
    EqualityExpression[@Image="=="][
      PrimaryExpression/PrimaryPrefix/Name[pmd-java:typeIs("java.util.Collection")]
      and PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
    ] and PrimaryExpression/PrimaryPrefix/Name[@Image = concat(../../../EqualityExpression["=="]/PrimaryExpression/PrimaryPrefix/Name/@Image, ".isEmpty")]
  ] or PrimaryExpression [
    PrimaryPrefix/Name[@Image = "CollectionUtils.isEmpty"]
    and PrimarySuffix/Arguments//Name
  ]
]
|
//EqualityExpression[@Image="=="][
  PrimaryExpression/PrimaryPrefix/Literal/BooleanLiteral[@True = false()]
  and PrimaryExpression/PrimaryPrefix/Expression/ConditionalOrExpression[
    EqualityExpression[@Image="=="][
      PrimaryExpression/PrimaryPrefix/Name[pmd-java:typeIs("java.util.Collection")]
      and PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
    ] and PrimaryExpression/PrimaryPrefix/Name[@Image = concat(../../../EqualityExpression["=="]/PrimaryExpression/PrimaryPrefix/Name/@Image, ".isEmpty")]
  ] or (
    PrimaryExpression/PrimaryPrefix/Name[@Image = "CollectionUtils.isEmpty"]
    and PrimaryExpression/PrimaryPrefix/Literal/BooleanLiteral[@True = false()]
  )
]
)
]]>
         </value>
      </property>
   </properties>
</rule>

<!-- ArrayUtils rules -->
<rule name="Prefer_ArrayUtils.isEmpty"
      language="java"
      message="Use org.apache.commons.lang3.ArrayUtils.isEmpty"
      class="net.sourceforge.pmd.lang.rule.XPathRule">
   <description>
      Instead of explicitly checking against null and the length
      of the array against 0, use ArrayUtils.isEmpty()
   </description>
   <priority>5</priority>
   <properties>
      <property name="version" value="2.0"/>
      <property name="xpath">
         <value>
<![CDATA[
//ConditionalOrExpression[
  EqualityExpression[@Image = "=="][
    PrimaryExpression/PrimaryPrefix/Literal/NullLiteral
    and PrimaryExpression/PrimaryPrefix/Name[
        (pmd-java:typeIsExactly("boolean[]")
        or pmd-java:typeIsExactly("byte[]")
        or pmd-java:typeIsExactly("char[]")
        or pmd-java:typeIsExactly("double[]")
        or pmd-java:typeIsExactly("float[]")
        or pmd-java:typeIsExactly("int[]")
        or pmd-java:typeIsExactly("java.lang.Object[]")
        or pmd-java:typeIsExactly("long[]")
        or pmd-java:typeIsExactly("short[]")
        ) and ../../../following-sibling::EqualityExpression[@Image= "=="][
          PrimaryExpression/PrimaryPrefix/Literal[@Image = "0"]
          and PrimaryExpression/PrimaryPrefix/Name[
            ends-with(@Image, ".length")
            and substring-before(@Image, ".length") = ../../../preceding-sibling::EqualityExpression//Name/@Image
          ]
        ]
    ]
  ]
]
]]>
         </value>
      </property>
   </properties>
</rule>

<rule name="Prefer_ArrayUtils.isNotEmpty"
      language="java"
      message="Use org.apache.commons.lang3.ArrayUtils.isNotEmpty"
      class="net.sourceforge.pmd.lang.rule.XPathRule">
   <description>
Use ArrayUtils.isNotEmpty()
   </description>
   <priority>5</priority>
   <properties>
      <property name="version" value="2.0"/>
      <property name="xpath">
         <value>
<![CDATA[
(//ConditionalAndExpression[
  EqualityExpression[@Image = "!="][
    PrimaryExpression/PrimaryPrefix/Name[(
      pmd-java:typeIsExactly("boolean[]")
      or pmd-java:typeIsExactly("byte[]")
      or pmd-java:typeIsExactly("char[]")
      or pmd-java:typeIsExactly("double[]")
      or pmd-java:typeIsExactly("float[]")
      or pmd-java:typeIsExactly("int[]")
      or pmd-java:typeIs("java.lang.Object[]")
      or pmd-java:typeIsExactly("long[]")
      or pmd-java:typeIsExactly("short[]")
    ) and ../../../following-sibling::EqualityExpression[@Image = "!="][
        PrimaryExpression/PrimaryPrefix/Literal[@Image = "0"]
        and PrimaryExpression/PrimaryPrefix/Name[
          ends-with(@Image, ".length")
          and substring-before(@Image, ".length") = ../../../preceding-sibling::EqualityExpression//Name/@Image
        ]
      ]      
    ]
  ]
]
|
//UnaryExpressionNotPlusMinus[@Image = "!" and PrimaryExpression/PrimaryPrefix/Name[@Image = "ArrayUtils.isEmpty"]]
|
//EqualityExpression[@Image = "=="][
  PrimaryExpression/PrimaryPrefix/Literal/BooleanLiteral[@True = false()]
  and PrimaryExpression/PrimaryPrefix/Name[@Image = "ArrayUtils.isEmpty"]
]
)
]]>
         </value>
      </property>
   </properties>
</rule>
</ruleset>
